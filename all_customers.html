<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>All Customers</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow navbar-expand-lg"> <!-- Added navbar-expand-lg for responsiveness -->
        <a class="navbar-brand col-md-3 col-lg-2 mr-0 px-3" href="index.html">Akshay Gate’s Driving School</a> <!-- Updated href and added px-3 -->
        <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-toggle="collapse" data-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <!-- Added a collapse div for the search and sign out for smaller screens -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto px-3"> <!-- Used ml-auto to push to the right -->
                 <li class="nav-item">
                    <input class="form-control form-control-dark" type="text" placeholder="Search" aria-label="Search"> <!-- Removed w-100 -->
                 </li>
                <li class="nav-item text-nowrap">
                    <a class="nav-link" href="#">Sign out</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse vh-100 border-right"> <!-- Added vh-100 and border -->
                <div class="sidebar-sticky pt-3 d-flex flex-column" style="height: calc(100% - 48px);"> <!-- Flex column for spacing -->
                    <!-- Branch Selector Dropdown -->
                    <div class="dropdown px-3 mb-3">
                        <button class="btn btn-secondary dropdown-toggle w-100 btn-sm" type="button" id="branchDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Select Branch
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="branchDropdown">
                            <li><a class="dropdown-item" href="#" data-branch="branchA">Branch A</a></li>
                            <li><a class="dropdown-item" href="#" data-branch="branchB">Branch B</a></li>
                        </ul>
                    </div>

                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html"> <!-- Removed active class -->
                                <span data-feather="home"></span>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="add_customer.html">
                                <span data-feather="user-plus"></span>
                                Add New Customer
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="all_customers.html"> <!-- Active class for this page -->
                                <span data-feather="users"></span>
                                All Customers <span class="sr-only">(current)</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="add_expense.html">
                                <span data-feather="dollar-sign"></span>
                                Add Expense
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="add_testimonial.html">
                                <span data-feather="message-square"></span>
                                Add Testimonial
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="manage_installments.html">
                                <span data-feather="calendar"></span>
                                Manage Installments
                            </a>
                        </li>
                         <li class="nav-item">
                            <a class="nav-link" href="manage_employees.html">
                                <span data-feather="briefcase"></span>
                                Manage Employees
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="reports.html">
                                <span data-feather="bar-chart-2"></span>
                                Reports
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="settings.html">
                                <span data-feather="settings"></span>
                                Settings
                            </a>
                        </li>
                    </ul>

                    <ul class="nav flex-column mt-auto mb-3"> <!-- Pushes logout to bottom -->
                        <hr class="mx-3">
                        <li class="nav-item">
                            <a class="nav-link text-danger" href="#">
                                <span data-feather="log-out"></span>
                                Logout
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
                 <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">All Customers</h1>
                 </div>

                 <!-- Search and Filter Row -->
                 <div class="row mb-3">
                    <div class="col-md-3">
                        <input type="text" id="search" placeholder="Search..." class="form-control form-control-sm">
                    </div>
                    <div class="col-md-3">
                        <select id="filter_branch" class="form-control form-control-sm">
                            <option value="">All Branches</option>
                            <option value="branchA">Branch A</option>
                            <option value="branchB">Branch B</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select id="filter_payment_status" class="form-control form-control-sm">
                            <option value="">All Status</option>
                            <option value="Active">Active</option>
                            <option value="Completed">Completed</option>
                            <option value="On Hold">On Hold</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select id="filter_course_type" class="form-control form-control-sm">
                            <option value="">All Courses</option>
                            <option value="driving_course">Driving Course</option>
                            <option value="2_wheeler">2 Wheeler</option>
                            <option value="3_wheeler">3 Wheeler</option>
                            <option value="4_wheeler_nt">4 Wheeler NT</option>
                            <option value="4_wheeler_tr">4 Wheeler TR</option>
                            <option value="licence">Licence</option>
                            <option value="licence_renewal">Licence Renewal</option>
                            <option value="vehicle_passing">Vehicle Passing</option>
                            <option value="vehicle_hp">Vehicle HP</option>
                            <option value="vehicle_transfer">Vehicle Transfer</option>
                        </select>
                    </div>
                 </div>

                 <!-- Customers Table -->
                 <div class="table-responsive">
                    <table id="customers-table" class="table table-striped table-sm">
                        <thead>
                            <tr>
                                <th>Name</th>
                        <th>Phone</th>
                        <th>Email</th>
                        <th>Course</th>
                        <th>Total Fee</th>
                        <th>Paid</th>
                        <th>Balance</th>
                        <th>Branch</th>
                        <th>Entry Date</th>
                        <th>Next Installment</th>
                        <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Customer rows will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                 </div>
            </main>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js"></script>
    <script>
        feather.replace(); // Initialize Feather Icons

        document.addEventListener('DOMContentLoaded', function () {
            const customersTableBody = document.getElementById('customers-table').getElementsByTagName('tbody')[0];
            const searchInput = document.getElementById('search');
            const branchFilter = document.getElementById('filter_branch');
            const statusFilter = document.getElementById('filter_payment_status');
            const courseFilter = document.getElementById('filter_course_type');
            let allCustomers = []; // To store the full customer list

            function renderTable(customers) {
                customersTableBody.innerHTML = ''; // Clear existing rows
                if (!customers || customers.length === 0) {
                    customersTableBody.innerHTML = '<tr><td colspan="12" class="text-center">No customers found.</td></tr>';
                    return;
                }

                customers.forEach(customer => {
                    let newRow = customersTableBody.insertRow();
                    newRow.dataset.customerId = customer.id; // Add ID for potential actions

                    let nameCell = newRow.insertCell();
                    let phoneCell = newRow.insertCell();
                    let emailCell = newRow.insertCell();
                    let courseCell = newRow.insertCell();
                    let totalFeeCell = newRow.insertCell();
                    let paidCell = newRow.insertCell();
                    let balanceCell = newRow.insertCell();
                    let branchCell = newRow.insertCell();
                    let entryDateCell = newRow.insertCell();
                    let nextInstallmentCell = newRow.insertCell();
                    let statusCell = newRow.insertCell();
                    let actionsCell = newRow.insertCell();

                    nameCell.textContent = customer.name || '-';
                    phoneCell.textContent = customer.phone || '-';
                    emailCell.textContent = customer.email || '-';
                    courseCell.textContent = customer.course || '-';
                    totalFeeCell.textContent = customer.totalFee !== undefined ? `₹${customer.totalFee}` : '-';
                    paidCell.textContent = customer.paid !== undefined ? `₹${customer.paid}` : '-';
                    balanceCell.textContent = customer.balance !== undefined ? `₹${customer.balance}` : '-';
                    branchCell.textContent = customer.branch || '-';
                    entryDateCell.textContent = customer.entryDate || '-';
                    nextInstallmentCell.textContent = customer.nextInstallment || '-';
                    statusCell.innerHTML = `<span class="badge badge-${getStatusBadge(customer.status)}">${customer.status || 'Unknown'}</span>`;
                    actionsCell.innerHTML = `
                        <button class="btn btn-sm btn-primary action-edit" title="Edit"><span data-feather="edit-2"></span></button>
                        <button class="btn btn-sm btn-info action-view" title="View"><span data-feather="eye"></span></button>
                        <button class="btn btn-sm btn-danger action-delete" title="Delete"><span data-feather="trash-2"></span></button>
                    `;
                });
                feather.replace(); // Re-initialize Feather Icons for new buttons
            }

            function getStatusBadge(status) {
                switch (status?.toLowerCase()) {
                    case 'active': return 'success';
                    case 'completed': return 'secondary';
                    case 'on hold': return 'warning';
                    default: return 'light';
                }
            }

            function filterAndSearch() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedBranch = branchFilter.value;
                const selectedStatus = statusFilter.value;
                const selectedCourse = courseFilter.value;

                const filteredCustomers = allCustomers.filter(customer => {
                    const matchesSearch = !searchTerm ||
                        customer.name?.toLowerCase().includes(searchTerm) ||
                        customer.phone?.toLowerCase().includes(searchTerm) ||
                        customer.course?.toLowerCase().includes(searchTerm);
                    const matchesBranch = !selectedBranch || customer.branch === selectedBranch;
                    const matchesStatus = !selectedStatus || customer.status === selectedStatus;
                    const matchesCourse = !selectedCourse || customer.course === selectedCourse;

                    return matchesSearch && matchesBranch && matchesStatus && matchesCourse;
                });

                renderTable(filteredCustomers);
            }

            function loadInitialData() {
                try {
                    // Get data from local storage
                    let dashboardData = JSON.parse(localStorage.getItem('dashboardData')) || { customers: [] };
                    allCustomers = dashboardData.customers || []; // Store the full list

                    // Initial render
                    renderTable(allCustomers);

                } catch (error) {
                    console.error("Error loading customer data:", error);
                    customersTableBody.innerHTML = '<tr><td colspan="12" class="text-center text-danger">Error loading data.</td></tr>';
                }
            }

            // --- Event Listeners ---
            searchInput.addEventListener('input', filterAndSearch);
            branchFilter.addEventListener('change', filterAndSearch);
            statusFilter.addEventListener('change', filterAndSearch);
            courseFilter.addEventListener('change', filterAndSearch);

            // Add event listener for action buttons (delegation)
            customersTableBody.addEventListener('click', function(event) {
                const button = event.target.closest('button');
                if (!button) return;

                const row = button.closest('tr');
                const customerId = row?.dataset.customerId;

                if (button.classList.contains('action-edit')) {
                    console.log('Edit customer:', customerId);
                    // Add edit functionality here (e.g., redirect to edit page or open modal)
                    alert(`Edit action for customer ID: ${customerId}`);
                } else if (button.classList.contains('action-view')) {
                    console.log('View customer:', customerId);
                    // Add view functionality here
                    alert(`View action for customer ID: ${customerId}`);
                } else if (button.classList.contains('action-delete')) {
                    console.log('Delete customer:', customerId);
                    if (confirm(`Are you sure you want to delete customer ID: ${customerId}?`)) {
                        // Add delete functionality here (remove from local storage and re-render)
                        try {
                            let dashboardData = JSON.parse(localStorage.getItem('dashboardData')) || { customers: [] };
                            dashboardData.customers = dashboardData.customers.filter(c => c.id != customerId);
                            localStorage.setItem('dashboardData', JSON.stringify(dashboardData));
                            allCustomers = dashboardData.customers; // Update the master list
                            filterAndSearch(); // Re-render the table
                            alert(`Customer ID: ${customerId} deleted.`);
                        } catch (error) {
                            console.error("Error deleting customer:", error);
                            alert("Failed to delete customer.");
                        }
                    }
                }
            });

            // --- Initial Load ---
            loadInitialData();

        });
    </script>
</body>
</html>

</file_content>

IMPORTANT: For any future changes to this file, use the final_file_content shown above as your reference. This content reflects the current state of the file, including any auto-formatting (e.g., if you used single quotes but the formatter converted them to double quotes). Always base your SEARCH/REPLACE operations on this final version to ensure accuracy.

<environment_details>
# VSCode Visible Files
all_customers.html

# VSCode Open Tabs
script.js
style.css
add_expense.html
add_testimonial.html
manage_installments.html
manage_employees.html
reports.html
settings.html
index.html
script.js
add_customer.html
all_customers.html

# Recently Modified Files
These files have been modified since you last accessed them (file was just edited so you may need to re-read it before editing):
index.html
add_customer.html

# Current Time
5/5/2025, 11:57:11 AM (Asia/Calcutta, UTC+5.5:00)

# Context Window Usage
349,810 / 1,048.576K tokens used (33%)

# Current Mode
ACT MODE
</environment_details>
